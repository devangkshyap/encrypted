<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secure Encryption App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --ink: #0e172a;
            --ink-soft: #1f2937;
            --sand: #f4f6fb;
            --accent: #2563eb;
            --accent-2: #38bdf8;
            --success: #0ea663;
            --error: #e15141;
            --card: #ffffffee;
            --border: rgba(14, 23, 42, 0.08);
            --shadow: 0 18px 42px rgba(14, 23, 42, 0.16);
            --radius: 14px;
        }

        .layout-grid { display: grid; grid-template-columns: minmax(320px, 2.1fr) minmax(260px, 1fr); gap: 1.4em; align-items: start; }
        .control-card { position: relative; overflow: hidden; }
        .control-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 15% 20%, rgba(56,189,248,0.10), transparent 32%),
                        radial-gradient(circle at 80% 30%, rgba(37,99,235,0.14), transparent 38%);
            pointer-events: none;
        }
        .side-card { background: linear-gradient(180deg, rgba(37,99,235,0.08), rgba(12,18,40,0.08)); border: 1px solid rgba(37,99,235,0.18); box-shadow: 0 14px 32px rgba(14,23,42,0.18); }
        .badge-row { display: flex; flex-wrap: wrap; gap: 0.45em; margin-bottom: 0.9em; }
        .chip { display: inline-flex; align-items: center; gap: 0.4em; padding: 0.5em 0.8em; border-radius: 999px; font-weight: 700; font-size: 0.9em; letter-spacing: 0.2px; background: rgba(13,19,33,0.06); color: var(--ink-soft); border: 1px solid rgba(13,19,33,0.08); }
        .chip.accent { background: rgba(37,99,235,0.14); color: #0e172a; border-color: rgba(37,99,235,0.26); }
        .chip.ghost { background: rgba(255,255,255,0.7); color: #0d1321; border-color: rgba(13,19,33,0.08); }
        .select-row { display: flex; align-items: center; gap: 0.8em; flex-wrap: wrap; }
        .field-stack { margin-bottom: 0.35em; }
        .strength-row { display: flex; align-items: center; gap: 0.6em; margin-top: -0.2em; margin-bottom: 0.8em; }
        .strength-label { font-size: 0.92em; font-weight: 600; color: var(--ink-soft); }
        .strength-bar { flex: 1; height: 8px; border-radius: 999px; background: rgba(13,19,33,0.07); overflow: hidden; border: 1px solid rgba(13,19,33,0.06); }
        .strength-bar span { display: block; height: 100%; width: 16%; border-radius: 999px; background: #e11d48; transition: width 0.25s ease, background 0.25s ease; }

        .pill-list { list-style: none; padding: 0; margin: 0 0 1.2em; display: grid; gap: 0.5em; }
        .pill-list .pill { display: inline-flex; align-items: center; gap: 0.5em; padding: 0.6em 0.75em; border-radius: 12px; background: rgba(255,255,255,0.72); border: 1px solid rgba(13,19,33,0.08); font-weight: 600; color: #0d1321; }
        .pill-list .pill svg { opacity: 0.8; }

        .micro-panels { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75em; margin-top: 0.4em; }
        .panel { padding: 0.9em; border-radius: 12px; background: #0d1321; color: #e7ecef; border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 12px 26px rgba(13,19,33,0.28); }
        .panel-label { font-size: 0.9em; opacity: 0.8; }
        .panel-value { display: block; font-size: 1.1em; font-weight: 700; margin-top: 0.35em; }

        .subtle-divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(15,23,42,0.15), transparent); margin: 0.8em 0 1em; }

        .timeline { list-style: none; padding: 0; margin: 0; position: relative; }
        .timeline li { padding: 0.65em 0.9em 0.75em 1.8em; background: rgba(15,23,42,0.03); border: 1px solid rgba(15,23,42,0.08); border-radius: 12px; margin-bottom: 0.65em; position: relative; }
        .timeline li::before { content: ''; position: absolute; left: 0.75em; top: 1.05em; width: 9px; height: 9px; border-radius: 50%; background: #2563eb; box-shadow: 0 0 0 5px rgba(37,99,235,0.2); }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Space Grotesk', 'DM Mono', sans-serif;
            color: var(--ink);
            background: radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.24) 0, transparent 32%),
                        radial-gradient(circle at 82% 12%, rgba(37, 99, 235, 0.24) 0, transparent 30%),
                        linear-gradient(135deg, #f8fbff 0%, #f3f6ff 48%, #eef3ff 100%);
            min-height: 100vh;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            z-index: -2;
            background: url('key-bg.jpg') center center/cover no-repeat;
            mix-blend-mode: screen;
            opacity: 0.14;
        }
        .dashboard { display: flex; min-height: 100vh; }
        .sidebar {
            width: 270px;
            min-width: 240px;
            background: linear-gradient(180deg, #0b1220 0%, #0f1c32 48%, #0b1220 100%);
            color: #e7ecf5;
            display: flex;
            flex-direction: column;
            padding: 1.4em 1.4em 1.8em;
            border-right: 1px solid rgba(255,255,255,0.08);
            box-shadow: 8px 0 40px rgba(15,23,42,0.28);
            position: relative;
            overflow: hidden;
        }
        .sidebar::after {
            content: '';
            position: absolute;
            inset: 12% 8% 8% 40%;
            background: radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.28), transparent 50%);
            filter: blur(24px);
            z-index: 0;
        }
        .sidebar * { position: relative; z-index: 1; }
        .logo-title { display: flex; align-items: center; gap: 0.75em; margin-bottom: 2.4em; }
        .app-title { font-size: 1.45em; font-weight: 700; letter-spacing: 0.6px; color: #e0f2fe; }
        .sidebar-info {
            margin: 1.2em 0 1.4em;
            font-size: 0.98em;
            line-height: 1.55;
            background: rgba(255,255,255,0.06);
            color: #e7ecef;
            border-radius: var(--radius);
            padding: 1.15em 1.1em;
            border: 1px solid rgba(255,255,255,0.14);
            box-shadow: 0 10px 28px rgba(0,0,0,0.18);
        }
        .sidebar-info ul { padding-left: 1.2em; margin: 0; }
        nav ul { list-style: none; padding: 0; margin: 0; display: grid; gap: 0.4em; }
        nav li a {
            display: block;
            padding: 0.65em 0.9em;
            border-radius: 10px;
            color: #e2e8f0;
            text-decoration: none;
            font-weight: 600;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.2s ease;
        }
        nav li a:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.18); color: #38bdf8; }
        .sidebar-footer { margin-top: auto; font-size: 0.98em; color: #cbd5e1; text-align: center; opacity: 0.9; }

        .container { flex: 1; padding: 2.2em 2.6em; }
        .hero { position: relative; overflow: hidden; border-radius: calc(var(--radius) + 6px); background: linear-gradient(135deg, #2563eb 0%, #38bdf8 55%, #c7e2ff 100%); padding: 1.6em 1.8em; box-shadow: var(--shadow); color: #0b172a; }
        .hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 80% 20%, rgba(255,255,255,0.35), transparent 36%);
            mix-blend-mode: screen;
        }
        .hero h1 { margin: 0.15em 0; font-size: 2.2em; letter-spacing: 0.4px; }
        .hero p { margin: 0; font-weight: 500; color: rgba(15,23,42,0.7); }
        .badge { display: inline-flex; align-items: center; gap: 0.35em; padding: 0.45em 0.75em; border-radius: 999px; background: rgba(255,255,255,0.28); border: 1px solid rgba(255,255,255,0.45); font-weight: 600; font-size: 0.92em; color: #0f172a; }

        .card {
            background: var(--card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: 1.6em 1.4em 1.4em;
            margin-bottom: 1.8em;
            backdrop-filter: blur(8px);
        }
        h3 { font-size: 1.28em; font-weight: 700; color: var(--ink-soft); margin: 0 0 0.9em; }
        label { font-weight: 600; margin-top: 1em; display: block; color: var(--ink-soft); letter-spacing: 0.1px; }
        textarea, input[type="password"], input[type="text"] {
            width: 100%;
            font-size: 1.04em;
            border-radius: 12px;
            border: 1.5px solid rgba(13,19,33,0.1);
            padding: 0.95em 1em;
            margin-bottom: 0.75em;
            background: #f8fafc;
            font-family: 'Space Grotesk', sans-serif;
            transition: border 0.15s ease, box-shadow 0.15s ease;
        }
        textarea:focus, input[type="password"]:focus, input[type="text"]:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(37,99,235,0.18); }
        /* Hide native Edge/IE password reveal so only our custom eye shows */
        input[type="password"]::-ms-reveal,
        input[type="password"]::-ms-clear { display: none; width: 0; height: 0; }
        textarea { min-height: 140px; resize: vertical; }
        .pw-wrapper { display: flex; align-items: center; gap: 0.5em; margin-bottom: 1em; }
        .toggle-pw {
            background: #0d1321;
            color: #e7ecef;
            border: 1px solid rgba(255,255,255,0.18);
            border-radius: 12px;
            cursor: pointer;
            padding: 0.55em 0.75em;
            transition: transform 0.15s ease, background 0.2s ease;
        }
        .toggle-pw:hover { transform: translateY(-1px); background: #1c2541; }
        .actions { display: flex; flex-wrap: wrap; gap: 0.55em; margin: 0.5em 0 1em; }
        button {
            border: none;
            border-radius: 12px;
            padding: 0.65em 1.35em;
            background: linear-gradient(135deg, #2563eb, #38bdf8);
            color: #0b172a;
            font-weight: 700;
            font-size: 0.98em;
            cursor: pointer;
            box-shadow: 0 10px 22px rgba(37,99,235,0.28);
            transition: transform 0.15s ease, box-shadow 0.2s ease, filter 0.2s ease;
        }
        button:hover { transform: translateY(-1px); box-shadow: 0 12px 26px rgba(37,99,235,0.4); filter: brightness(1.02); }
        .clear-btn, .copy-btn {
            background: #0b1220;
            color: #e7ecf5;
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 10px 22px rgba(11,18,32,0.28);
        }
        .clear-btn:hover, .copy-btn:hover { filter: brightness(1.06); }
        .output {
            margin-top: 1.2em;
            word-break: break-all;
            background: #ffffff;
            border: 1px solid rgba(13,19,33,0.15);
            color: #0d1321;
            padding: 1.2em 1em;
            border-radius: var(--radius);
            font-size: 1.08em;
            min-height: 2em;
            box-shadow: 0 18px 32px rgba(13,19,33,0.08);
        }
        .output-meta { margin-top: 0.35em; font-size: 0.9em; color: rgba(13,19,33,0.72); font-weight: 600; }
        .notif {
            display: none;
            margin: 0.4em 0 0.8em;
            padding: 0.65em 0.9em;
            border-radius: 10px;
            background: rgba(37,99,235,0.10);
            color: var(--ink-soft);
            border: 1px solid rgba(37,99,235,0.3);
            font-weight: 600;
        }
        .notif.success { background: rgba(14,166,99,0.12); border-color: rgba(14,166,99,0.42); color: #0f5132; }
        .notif.error { background: rgba(225,81,65,0.12); border-color: rgba(225,81,65,0.4); color: #7f1d1d; }

        .rsa-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 1.1em; align-items: stretch; }
        .rsa-actions { display: flex; gap: 0.6em; flex-wrap: wrap; margin-bottom: 0.8em; align-items: center; }
        .rsa-keyarea { min-height: 240px; font-family: 'DM Mono', monospace; }
        .rsa-btn, .rsa-copy-btn { width: fit-content; }

        input[type="file"]::-webkit-file-upload-button,
        input[type="file"]::file-selector-button {
            background: #2563eb;
            color: #0b172a;
            border: none;
            border-radius: 10px;
            padding: 0.55em 1.2em;
            font-size: 0.95em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: 0 8px 18px rgba(37,99,235,0.28);
        }
        input[type="file"]::-webkit-file-upload-button:hover,
        input[type="file"]::file-selector-button:hover { transform: translateY(-1px); }
        input[type="file"] {
            font-size: 0.95em;
            color: var(--ink-soft);
            background: #f7f9fc;
            border-radius: 12px;
            border: 1.5px solid rgba(15,23,42,0.08);
            padding: 0.35em 0.55em;
            margin: 0.35em 0 1em;
        }

        @media (max-width: 840px) {
            .dashboard { flex-direction: column; }
            .sidebar { width: 100%; flex-direction: row; gap: 1em; align-items: flex-start; }
            nav ul { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
            .container { padding: 1.4em 1.2em 1.6em; }
            .hero h1 { font-size: 1.7em; }
        }

        body.dark-mode { background: #0b1222; color: #e2e8f0; }
        body.dark-mode .card { background: rgba(18, 28, 48, 0.9); border-color: rgba(255,255,255,0.05); box-shadow: 0 18px 42px rgba(0,0,0,0.45); }
        body.dark-mode textarea,
        body.dark-mode input[type="password"],
        body.dark-mode input[type="text"],
        body.dark-mode input[type="file"] { background: #0f172a; color: #e2e8f0; border-color: rgba(255,255,255,0.08); }
        body.dark-mode .output { background: #f8fafc; border-color: rgba(13,19,33,0.15); color: #0d1321; }
        body.dark-mode nav li a { background: rgba(255,255,255,0.06); }
        body.dark-mode nav li a:hover { background: rgba(255,255,255,0.12); }
        body.dark-mode .hero { color: #0b172a; }
    </style>
</head>
<body>
<div class="dashboard">
    <aside class="sidebar">
        <div class="logo-title">
            <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="24" cy="24" r="22" stroke="#2563eb" stroke-width="4" fill="#e6f2ff"/>
                <rect x="14" y="20" width="20" height="14" rx="3" fill="#2563eb"/>
                <rect x="18" y="24" width="12" height="6" rx="2" fill="#fff"/>
                <circle cx="24" cy="27" r="1.5" fill="#0e172a"/>
                <rect x="20" y="16" width="8" height="6" rx="2" fill="#fff" stroke="#2563eb" stroke-width="2"/>
            </svg>
            <span class="app-title">Secure Encryption</span>
        </div>
        <div class="sidebar-info" style="margin-bottom:1.5em;background:#111a2d;color:#e7ecf5;box-shadow:0 2px 12px rgba(37,99,235,0.22);">
            <div style="margin-bottom:0.7em;">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="10" width="14" height="9" rx="3" fill="#2563eb"/><rect x="9" y="6" width="6" height="6" rx="3" fill="#fff" stroke="#2563eb" stroke-width="2"/><circle cx="12" cy="15" r="1.2" fill="#fff"/></svg>
                <span style="font-weight:700;font-size:1.08em;">What is Cryptography?</span>
            </div>
            <ul style="margin:0 0 0 1.2em;padding:0;font-size:0.98em;line-height:1.6;">
                <li><b>Cryptography</b> is the science of securing information by transforming it so only intended recipients can read it.</li>
                <li><b>Encryption</b> protects your data from unauthorized access, even if intercepted.</li>
                <li><b>AES-GCM</b> is a modern, fast, and secure encryption standard for data privacy.</li>
                <li><b>RSA</b> enables secure sharing using public/private key pairs.</li>
                <li>Never share your password or private key with anyone.</li>
            </ul>
        </div>
            <nav>
                <ul class="sidebar-nav">
                    <li><a href="#main">Encrypt/Decrypt</a></li>
                    <li><a href="#rsa">RSA Key Management</a></li>
                    <li><a href="#history">History</a></li>
                </ul>
            </nav>
        <div class="sidebar-footer">AES-GCM & RSA Hybrid<br><small>by YourApp</small></div>
    </aside>
    <div class="container">
        <div style="position:relative;margin-bottom:2.4em;">
            <div class="hero">
                <span class="badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 7.5L12 3l8 4.5v9L12 21l-8-4.5v-9Z" stroke="#0f172a" stroke-width="1.6" fill="rgba(15,23,42,0.08)"/><path d="M8.5 12.5l2.2 2.2 4.8-4.8" stroke="#0f172a" stroke-width="1.8" stroke-linecap="round"/></svg>
                    AES-GCM + RSA Hybrid
                </span>
                <div style="display:flex;align-items:center;gap:1em;flex-wrap:wrap;margin-top:0.6em;">
                    <img src="assets/logo.svg" alt="App Logo" width="62" height="62" style="display:block;filter:drop-shadow(0 10px 24px rgba(0,0,0,0.25));border-radius:14px;background:#ffffffdd;padding:0.35em;" />
                    <div>
                        <h1 style="margin:0;color:#0b172a;font-size:2.1em;">Secure Encryption Suite</h1>
                        <p style="margin:0.2em 0 0;color:rgba(15,23,42,0.75);font-weight:600;">Protect text & files with password-based AES-GCM or share safely via RSA hybrid.</p>
                    </div>
                </div>
                <p style="margin:1em 0 0;color:rgba(15,23,42,0.7);font-weight:600;">Fast client experience, trusted Python cryptography backend, clear feedback on every action.</p>
            </div>
        </div>
        <section id="main" class="layout-grid">
            <div class="card control-card">
                <div class="field-stack">
                    <label style="font-weight:700;font-size:1.13em;min-width:170px;">Encryption Method:</label>
                    <div class="select-row">
                        <select id="encMethod" style="font-size:1.08em;padding:0.55em 1.2em;border-radius:12px;border:1.6px solid #2563eb;background:#f8fafc;color:#0e172a;font-weight:700;outline:none;transition:border 0.2s, box-shadow 0.2s;box-shadow:0 0 0 0 rgba(37,99,235,0.18);">
                            <option value="aes">AES-GCM (Password)</option>
                            <option value="rsa">RSA Hybrid (Public Key)</option>
                        </select>
                        <span style="margin-left:0.2em;font-size:1em;color:#2563eb;font-weight:700;">
                            <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;"><circle cx="10" cy="10" r="9" fill="#e8f3ff" stroke="#2563eb" stroke-width="2"/><text x="10" y="15" text-anchor="middle" font-size="12" fill="#2563eb" font-family="Arial, sans-serif">i</text></svg>
                            <span id="methodHelp">AES-GCM: Fast, secure, password-based. RSA: Share with others using public key.</span>
                        </span>
                    </div>
                </div>
                <div class="notif" id="notif"></div>
                <div class="field-stack">
                    <label>Text to Encrypt/Decrypt:</label>
                    <textarea id="textInput" rows="4" placeholder="Enter text or ciphertext here..."></textarea>
                </div>
                <div class="field-stack" id="passwordSection">
                    <label>Password (min 8 chars, 12+ recommended):</label>
                    <div class="pw-wrapper">
                        <input type="password" id="passwordInput" minlength="8" />
                        <button class="toggle-pw" type="button" onclick="togglePassword()" title="Show/Hide Password">
                            <svg id="eyeIcon" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                                <path d="M1 12C2.73 7.61 7.11 4.5 12 4.5C16.89 4.5 21.27 7.61 23 12C21.27 16.39 16.89 19.5 12 19.5C7.11 19.5 2.73 16.39 1 12Z" stroke="#2563eb" stroke-width="2"/>
                                <circle cx="12" cy="12" r="2.5" fill="#2563eb"/>
                            </svg>
                        </button>
                    </div>
                    <div class="strength-row">
                        <span class="strength-label">Password strength</span>
                        <div class="strength-bar"><span id="strengthFill"></span></div>
                    </div>
                </div>
                <div class="notif" id="rsaModeWarning" style="display:none;background:rgba(241,169,53,0.12);border-color:rgba(241,169,53,0.4);color:#78350f;margin-top:0.8em;">RSA Hybrid mode uses public/private keys, not passwords. Password field is disabled.</div>
                <div class="actions primary-actions">
                    <button onclick="encryptText()">Encrypt</button>
                    <button onclick="decryptText()">Decrypt</button>
                    <button class="clear-btn" onclick="clearFields()">Clear</button>
                    <button class="copy-btn" onclick="copyOutput()">Copy Output</button>
                    <button onclick="toggleDarkMode()">ðŸŒ™</button>
                </div>
                <div class="subtle-divider"></div>
                <div class="field-stack">
                    <label>Or select a file (or drag & drop):</label>
                    <input type="file" id="fileInput" />
                </div>
                <div class="actions">
                    <button onclick="encryptFile()">Encrypt File</button>
                    <button onclick="decryptFile()">Decrypt File</button>
                </div>
                <div style="margin-top:0.6em;">
                    <div style="font-weight:700;color:var(--ink-soft);margin-bottom:0.2em;">Ciphertext (Base64 envelope)</div>
                    <div style="font-size:0.95em;color:rgba(13,19,33,0.72);margin-bottom:0.4em;">Contains metadata + nonce + ciphertext; use Copy before switching methods.</div>
                    <div class="output" id="output" aria-live="polite" ondragover="event.preventDefault()" ondrop="handleDrop(event)"></div>
                    <div class="output-meta" id="outputMeta"></div>
                </div>
            </div>
            <div class="card side-card">
                <h3>Safety checklist</h3>
                <ul class="pill-list">
                    <li class="pill accent">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 7 9 18l-5-5" stroke="#0f172a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Use 12+ character passwords
                    </li>
                    <li class="pill">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3 2 9l10 6 10-6-10-6Z" stroke="#0f172a" stroke-width="2"/><path d="M2 15l10 6 10-6" stroke="#0f172a" stroke-width="2"/></svg>
                        Store private keys offline
                    </li>
                    <li class="pill">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14" stroke="#0f172a" stroke-width="2" stroke-linecap="round"/><path d="M5 12h14" stroke="#0f172a" stroke-width="2" stroke-linecap="round"/></svg>
                        Verify recipients before sharing
                    </li>
                </ul>
                <div class="micro-panels">
                    <div class="panel">
                        <span class="panel-label">AES-GCM</span>
                        <span class="panel-value">Fast + Auth</span>
                    </div>
                    <div class="panel">
                        <span class="panel-label">RSA Hybrid</span>
                        <span class="panel-value">Share via public key</span>
                    </div>
                    <div class="panel">
                        <span class="panel-label">History</span>
                        <span class="panel-value">Session-only</span>
                    </div>
                </div>
                <p style="margin:1em 0 0;font-weight:600;color:#0f172a;">Need a quick refresher?</p>
                <p style="margin:0.2em 0 0;color:#1e293b;">Generate RSA keys, paste keys safely, and use the copy buttons to avoid truncation errors.</p>
            </div>
        </section>
        <section id="rsa" style="margin-top:2.5em;">
            <div class="card">
                <h3 style="margin-bottom:0.6em;">RSA Key Management</h3>
                <div class="rsa-actions">
                    <button class="rsa-btn" onclick="generateRSAKeys()">Generate Key Pair</button>
                    <button class="clear-btn" onclick="clearRSAKeys()">Clear Keys</button>
                </div>
                <div class="rsa-row">
                    <div class="rsa-col">
                        <textarea id="publicKey" class="rsa-keyarea" rows="8" placeholder="Public Key (PEM)"></textarea>
                        <div class="actions" style="gap:0.5em;margin:0.5em 0 0;">
                            <button class="rsa-copy-btn" onclick="copyKey('publicKey')">Copy Public Key</button>
                        </div>
                    </div>
                    <div class="rsa-col">
                        <textarea id="privateKey" class="rsa-keyarea" rows="8" placeholder="Private Key (PEM)"></textarea>
                        <div class="actions" style="gap:0.5em;margin:0.5em 0 0;">
                            <button class="rsa-copy-btn" onclick="copyKey('privateKey')">Copy Private Key</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="history" style="margin-top:2.5em;">
            <div class="card">
                <h3>Audit Log (Session-Only)</h3>
                <p style="font-size:0.95em;color:rgba(13,19,33,0.72);margin-bottom:0.8em;">Cryptographic operations logged without plaintext or passwords for security.</p>
                <button onclick="refreshAuditLog()" style="margin-bottom:0.8em;">Refresh Log</button>
                <ul id="auditLogList" class="timeline" style="min-height:2em;"></ul>
            </div>
        </section>
        <section id="user-history" style="margin-top:2.5em;">
            <h3>Encryption History (Local)</h3>
            <ul id="historyList" class="timeline" style="min-height:2em;"></ul>
        </section>
        <section id="info" style="margin-top:2.5em;">
            <div class="card">
                <h3>About This App & Cryptography</h3>
                <p>This app lets you securely encrypt and decrypt text or files using modern cryptography standards. Choose between password-based AES-GCM or RSA hybrid encryption for sharing with others.</p>
                <ul style="margin-left:1.2em;">
                    <li><b>AES-GCM</b>: Fast, secure, and provides data integrity. Use a strong password.</li>
                    <li><b>RSA Hybrid</b>: Encrypts a random key with RSA, then uses AES-GCM for your data. Share your public key, keep your private key safe.</li>
                    <li><b>Digital Signatures</b>: Sign messages with your private key; others verify with your public key.</li>
                    <li><b>File Hashing</b>: Verify that files haven't been modified using SHA-256.</li>
                    <li>Never share your password or private key with anyone.</li>
                    <li>All cryptography is performed using the trusted Python <code>cryptography</code> library.</li>
                </ul>
                <p style="margin-top:1em; color:#2563eb;">For more details, see the documentation or contact the developer.</p>
            </div>
        </section>
    </div>
</div>
<script>
// API Configuration
const BACKEND_URL = 'https://kakashi09.pythonanywhere.com';
const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
    ? 'http://localhost:5000' 
    : BACKEND_URL;

let historyArr = [];

document.getElementById('passwordInput').addEventListener('input', updateStrength);

function updateHistory(action, method, input, output) {
    historyArr.push({action, method, input, output, time: new Date().toLocaleTimeString()});
    const list = document.getElementById('historyList');
    list.innerHTML = historyArr.map(h => `<li><b>${h.action}</b> [${h.method}] at ${h.time}<br><span style='color:#888;'>Input:</span> ${h.input.slice(0,40)}...<br><span style='color:#888;'>Output:</span> ${h.output.slice(0,40)}...</li>`).join('');
}

function copyKey(id) {
    const val = document.getElementById(id).value;
    if (val) {
        navigator.clipboard.writeText(val);
        showNotif('Key copied!', 'success');
    }
}

async function generateRSAKeys() {
    const res = await fetch(`${API_BASE_URL}/api/generate_rsa_keys`);
    const data = await res.json();
    document.getElementById('publicKey').value = data.public_key;
    document.getElementById('privateKey').value = data.private_key;
    
    // Show fingerprint for key verification
    const fingerprint = data.fingerprint || '';
    showNotif(`RSA key pair generated! Fingerprint: ${fingerprint.substring(0, 16)}...`, 'success');
}

document.getElementById('encMethod').addEventListener('change', function() {
    const help = document.getElementById('methodHelp');
    const passwordSection = document.getElementById('passwordSection');
    const rsaWarning = document.getElementById('rsaModeWarning');
    const passwordInput = document.getElementById('passwordInput');
    
    if (this.value === 'aes') {
        help.textContent = 'AES-GCM: Fast, secure, password-based. Requires strong password (12+ chars recommended).';
        passwordSection.style.opacity = '1';
        passwordSection.style.pointerEvents = 'auto';
        passwordInput.disabled = false;
        rsaWarning.style.display = 'none';
    } else {
        help.textContent = 'RSA Hybrid: Share safely via public key. No password needed. Keep private key secret.';
        passwordSection.style.opacity = '0.5';
        passwordSection.style.pointerEvents = 'none';
        passwordInput.disabled = true;
        passwordInput.value = '';
        rsaWarning.style.display = 'block';
        updateStrength();
    }
});
function downloadFile(filename, content) {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([content], {type: 'application/octet-stream'}));
    a.download = filename;
    a.click();
}

function showNotif(msg, type) {
    const notif = document.getElementById('notif');
    notif.textContent = msg;
    notif.className = 'notif ' + (type || '');
    notif.style.display = 'block';
    setTimeout(() => notif.style.display = 'none', 2500);
}

async function updateOutputView(text) {
    const out = document.getElementById('output');
    const meta = document.getElementById('outputMeta');
    if (out) out.textContent = text || '';
    if (!meta) return;
    if (!text) { meta.textContent = ''; return; }
    try {
        const data = new TextEncoder().encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer).slice(0, 8));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        meta.textContent = `Length: ${text.length} chars Â· SHA-256 (first 8 bytes): ${hashHex}`;
    } catch (err) {
        meta.textContent = `Length: ${text.length} chars`;
    }
}

function updateStrength() {
    const pw = document.getElementById('passwordInput').value || '';
    const bar = document.getElementById('strengthFill');
    if (!bar) return;
    
    // If password is empty, reset the bar
    if (pw.length === 0) {
        bar.style.width = '0%';
        bar.style.background = '#e11d48';
        return;
    }
    
    let score = 0;
    if (pw.length >= 6) score += 20;
    if (pw.length >= 10) score += 20;
    if (/[A-Z]/.test(pw)) score += 20;
    if (/[0-9]/.test(pw)) score += 20;
    if (/[^A-Za-z0-9]/.test(pw)) score += 20;
    const width = Math.min(score, 100);
    bar.style.width = width + '%';
    if (width >= 80) {
        bar.style.background = '#0ea663';
    } else if (width >= 50) {
        bar.style.background = '#f59e0b';
    } else {
        bar.style.background = '#e11d48';
    }
}

function togglePassword() {
    const pw = document.getElementById('passwordInput');
    pw.type = pw.type === 'password' ? 'text' : 'password';
}

function clearFields() {
    document.getElementById('textInput').value = '';
    document.getElementById('passwordInput').value = '';
    document.getElementById('output').textContent = '';
    const meta = document.getElementById('outputMeta');
    if (meta) meta.textContent = '';
    document.getElementById('fileInput').value = '';
    updateStrength();
    showNotif('Cleared all fields', 'success');
}

function copyOutput() {
    const out = document.getElementById('output').textContent;
    if (out) {
        navigator.clipboard.writeText(out);
        showNotif('Output copied!', 'success');
    } else {
        showNotif('Nothing to copy', 'error');
    }
}

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
}

function handleDrop(event) {
    event.preventDefault();
    const fileInput = document.getElementById('fileInput');
    if (event.dataTransfer.files.length) {
        fileInput.files = event.dataTransfer.files;
        showNotif('File dropped: ' + event.dataTransfer.files[0].name, 'success');
    }
}

function clearRSAKeys() {
    const pub = document.getElementById('publicKey');
    const priv = document.getElementById('privateKey');
    if (pub) pub.value = '';
    if (priv) priv.value = '';
    showNotif('RSA keys cleared', 'success');
}

function isBase64(str) {
    try {
        return btoa(atob(str)) === str;
    } catch (e) { return false; }
}

async function encryptText() {
    const text = document.getElementById('textInput').value;
    const method = document.getElementById('encMethod').value;
    if (!text) return showNotif('Enter text.', 'error');
    let res, data;
    if (method === 'aes') {
        const password = document.getElementById('passwordInput').value;
        if (!password) return showNotif('Enter password.', 'error');
        if (password.length < 8) return showNotif('Password must be at least 8 characters.', 'error');
        if (isBase64(text.trim())) {
            showNotif('Input looks like ciphertext. Try Decrypt.', '');
        }
        res = await fetch(`${API_BASE_URL}/api/encrypt`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ plaintext: text, password, profile: 'balanced' })
        });
        data = await res.json();
    } else {
        const publicKey = document.getElementById('publicKey').value;
        if (!publicKey) return showNotif('Paste or generate a public key.', 'error');
        res = await fetch(`${API_BASE_URL}/api/rsa_encrypt`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ plaintext: text, public_key: publicKey })
        });
        data = await res.json();
    }
    if (data.ciphertext) {
        await updateOutputView(data.ciphertext);
        showNotif('Text encrypted!', 'success');
        updateHistory('Encrypt', method.toUpperCase(), text, data.ciphertext);
    } else {
        await updateOutputView(data.error || '');
        showNotif(data.error || 'Encryption failed', 'error');
    }
}
async function decryptText() {
    const ciphertext = document.getElementById('textInput').value;
    const method = document.getElementById('encMethod').value;
    if (!ciphertext) return showNotif('Enter ciphertext.', 'error');
    let res, data;
    if (method === 'aes') {
        const password = document.getElementById('passwordInput').value;
        if (!password) return showNotif('Enter password.', 'error');
        if (!isBase64(ciphertext.trim())) {
            showNotif('Input does not look like ciphertext. Try Encrypt.', '');
        }
        res = await fetch(`${API_BASE_URL}/api/decrypt`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ciphertext, password })
        });
        data = await res.json();
    } else {
        const privateKey = document.getElementById('privateKey').value;
        if (!privateKey) return showNotif('Paste your private key.', 'error');
        res = await fetch(`${API_BASE_URL}/api/rsa_decrypt`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ciphertext, private_key: privateKey })
        });
        data = await res.json();
    }
    if (data.plaintext) {
        await updateOutputView(data.plaintext);
        showNotif('Text decrypted!', 'success');
        updateHistory('Decrypt', method.toUpperCase(), ciphertext, data.plaintext);
    } else {
        // Enhanced error messages
        const error = data.error || 'Decryption failed';
        if (error.includes('Wrong password')) {
            showNotif('âŒ Wrong password or corrupted ciphertext', 'error');
        } else if (error.includes('tampered')) {
            showNotif('âš ï¸ Ciphertext appears tampered or corrupted', 'error');
        } else {
            showNotif(error, 'error');
        }
        await updateOutputView(error);
    }
}

async function encryptFile() {
    const fileInput = document.getElementById('fileInput');
    const password = document.getElementById('passwordInput').value;
    if (!fileInput.files.length || !password) return alert('Select a file and enter password.');
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = async function(e) {
        const filedata_b64 = btoa(e.target.result);
        const res = await fetch(`${API_BASE_URL}/api/encrypt_file`, {
            method: 'POST',
            body: JSON.stringify({
                filename: file.name,
                filedata_b64: filedata_b64,
                password
            }),
            headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (data.ciphertext) {
            downloadFile(file.name + '.enc', data.ciphertext);
            await updateOutputView('File encrypted and downloaded.');
            showNotif('File encrypted successfully!', 'success');
        } else {
            await updateOutputView(data.error || '');
            showNotif('File encryption failed.', 'error');
        }
    };
    reader.readAsBinaryString(file);
}

async function decryptFile() {
    const fileInput = document.getElementById('fileInput');
    const password = document.getElementById('passwordInput').value;
    if (!fileInput.files.length || !password) return alert('Select a file and enter password.');
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = async function(e) {
        const ciphertext = e.target.result;
        const res = await fetch(`${API_BASE_URL}/api/decrypt_file`, {
            method: 'POST',
            body: JSON.stringify({
                filename: file.name,
                ciphertext: ciphertext,
                password
            }),
            headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (data.plainfile) {
            downloadFile(data.filename || 'decrypted', new Uint8Array(data.plainfile));
            await updateOutputView('File decrypted and downloaded.');
            showNotif('File decrypted successfully!', 'success');
        } else {
            await updateOutputView(data.error || '');
            showNotif('File decryption failed.', 'error');
        }
    };
    reader.readAsText(file);
}

updateStrength();

// --- NEW FUNCTIONS ---

async function signMessage() {
    const message = document.getElementById('messageToSign').value;
    const privateKey = document.getElementById('privateKey').value;
    
    if (!message) return showNotif('Enter message to sign.', 'error');
    if (!privateKey) return showNotif('Generate or paste private key first.', 'error');
    
    try {
        const res = await fetch(`${API_BASE_URL}/api/rsa_sign`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, private_key: privateKey })
        });
        const data = await res.json();
        
        if (data.signature) {
            document.getElementById('signature').value = data.signature;
            showNotif('Message signed!', 'success');
        } else {
            showNotif('Signing failed: ' + data.error, 'error');
        }
    } catch (e) {
        showNotif('Error: ' + e.message, 'error');
    }
}

async function verifySignature() {
    const message = document.getElementById('messageToSign').value;
    const signature = document.getElementById('signature').value;
    const publicKey = document.getElementById('publicKey').value;
    
    if (!message || !signature || !publicKey) {
        return showNotif('Enter message, signature, and public key.', 'error');
    }
    
    try {
        const res = await fetch(`${API_BASE_URL}/api/rsa_verify`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, signature, public_key: publicKey })
        });
        const data = await res.json();
        
        if (data.valid) {
            showNotif('âœ“ Signature verified!', 'success');
        } else {
            showNotif('âœ— Signature verification failed', 'error');
        }
    } catch (e) {
        showNotif('Error: ' + e.message, 'error');
    }
}

async function computeFileHash() {
    const fileInput = document.getElementById('fileInput');
    
    if (!fileInput.files.length) {
        return showNotif('Select a file first.', 'error');
    }
    
    const file = fileInput.files[0];
    const reader = new FileReader();
    
    reader.onload = async function(e) {
        try {
            const filedata_b64 = btoa(e.target.result);
            const res = await fetch(`${API_BASE_URL}/api/verify_file_hash`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ filedata_b64 })
            });
            const data = await res.json();
            
            if (data.hash) {
                document.getElementById('hashValue').innerText = data.hash;
                document.getElementById('hashResult').style.display = 'block';
                showNotif('File hash computed: ' + data.hash.substring(0, 16) + '...', 'success');
            } else {
                showNotif('Hash computation failed', 'error');
            }
        } catch (e) {
            showNotif('Error: ' + e.message, 'error');
        }
    };
    reader.readAsBinaryString(file);
}

async function refreshAuditLog() {
    try {
        const res = await fetch(`${API_BASE_URL}/api/audit_log`);
        const data = await res.json();
        const list = document.getElementById('auditLogList');
        
        if (!data.log || data.log.length === 0) {
            list.innerHTML = '<li style="color:rgba(13,19,33,0.6);">No operations logged yet.</li>';
            return;
        }
        
        list.innerHTML = data.log.map(entry => `
            <li>
                <b>${entry.operation}</b> [${entry.method}] at ${new Date(entry.timestamp).toLocaleTimeString()}<br>
                <span style='color:#888;'>Status:</span> ${entry.success ? 'âœ“ Success' : 'âœ— Failed: ' + (entry.error || 'Unknown')}<br>
                <span style='color:#888;'>Details:</span> ${JSON.stringify(entry.details).slice(0, 60)}...
            </li>
        `).join('');
        showNotif('Audit log refreshed', 'success');
    } catch (e) {
        showNotif('Error fetching audit log: ' + e.message, 'error');
    }
}

function toggleCompressionUI() {
    const textInput = document.getElementById('textInput').value;
    if (!textInput) return showNotif('Enter text to compress.', 'error');
    
    try {
        const res = fetch(`${API_BASE_URL}/api/compress_data`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ plaintext: textInput })
        });
        res.then(r => r.json()).then(data => {
            if (data.original_size) {
                showNotif(`Compressed: ${data.original_size} â†’ ${data.compressed_size} bytes (${data.compression_ratio} reduction)`, 'success');
                const output = document.getElementById('output');
                if (output) output.textContent = data.data;
                const meta = document.getElementById('outputMeta');
                if (meta) meta.textContent = `Compressed size: ${data.compressed_size} bytes | Ratio: ${data.compression_ratio}`;
            } else {
                showNotif(data.error || 'Compression failed', 'error');
            }
        });
    } catch (e) {
        showNotif('Error: ' + e.message, 'error');
    }
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text);
    showNotif('Copied to clipboard!', 'success');
}

</script>
</body>
</html>
